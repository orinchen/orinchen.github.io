
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>玩转字符串 - O&#8217;s World</title>
  <meta name="author" content="Orin Chen">

  
  <meta name="description" content="在每个应用里我们都大量使用字符串。下面我们将快速看看一些常见的操作字符串的方法，过一遍常见操作的最佳实践。 字符串的比较、搜索和排序 排序和比较字符串比第一眼看上去要复杂得多。不只是因为字符串可以包含 代理对（surrogate pairs） (详见 Ole 写的这篇关于 Unicode 的文章 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://orinchen.github.io/blog/2014/03/07/working-with-strings">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="O's World" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Delius' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">O&#8217;s World</a></h1>
  
    <h2>努力！奋斗！</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="orinchen.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有文章</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">玩转字符串</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-07T23:32:36+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:32 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://orinchen.github.io">评论</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>在每个应用里我们都大量使用字符串。下面我们将快速看看一些常见的操作字符串的方法，过一遍常见操作的最佳实践。</p>

<!--more-->


<h2>字符串的比较、搜索和排序</h2>

<p>排序和比较字符串比第一眼看上去要复杂得多。不只是因为字符串可以包含 <strong>代理对（surrogate pairs）</strong> (详见 <a href="http://www.objc.io/issue-9/unicode.html#peculiar-unicode-features">Ole 写的这篇关于 Unicode 的文章</a>) ，而且比较还与字符串的本地化相关。在某些极端情况下相当棘手。</p>

<p>苹果文档中 <strong><em>String Programming Guide</em></strong> 里有一节叫做<strong>“字符与字形集群（Characters and Grapheme Clusters）”</strong>，里面提到一些陷阱。例如对于排序来说，一些欧洲语言将序列“ch”当作单个字母。在一些语言里，“ä”被认为等同于“a”，而在其它语言里它却被排在“z”后面。</p>

<p>而 <code>NSString</code> 有一些方法来帮助我们处理这种复杂性。首先看下面的方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="n">NSComparisonResult</span><span class="p">)</span><span class="nf">compare:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">aString</span>
</span><span class='line'>                      <span class="nf">options:</span><span class="p">(</span><span class="n">NSStringCompareOptions</span><span class="p">)</span><span class="nv">mask</span>
</span><span class='line'>                        <span class="nf">range:</span><span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="nv">range</span>
</span><span class='line'>                       <span class="nf">locale:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">locale</span>
</span></code></pre></td></tr></table></div></figure>


<p>它带给我们充分的灵活性。另外，还有很多“便捷函数”都使用了这个方法。
与比较有关的可用参数如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSCaseInsensitiveSearch</span>
</span><span class='line'><span class="n">NSLiteralSearch</span>
</span><span class='line'><span class="n">NSNumericSearch</span>
</span><span class='line'><span class="n">NSDiacriticInsensitiveSearch</span>
</span><span class='line'><span class="n">NSWidthInsensitiveSearch</span>
</span><span class='line'><span class="n">NSForcedOrderingSearch</span>
</span></code></pre></td></tr></table></div></figure>


<p>它们都可以用逻辑或运算组合在一起。</p>

<ul>
<li><p><code>NSCaseInsensitiveSearch</code>：“A”等同于“a”，然而在某些地方还有更复杂的情况。例如，在德国，“ß” 和“SS”是等价的。</p></li>
<li><p><code>NSLiteralSearch</code>：Unicode 的点对 Unicode 点比较。它只在所有字符都用相同的方式组成的情况下才会返回相等。LATIN CAPITAL LETTER A 加上 COMBINING RING ABOVE 并不等同于 LATIN CAPITAL LETTER A WITH RING ABOVE.</p></li>
</ul>


<blockquote><p>译注：这个要解释一下，首先，每一个Unicode都是有官方名字的！LATIN CAPITAL  LETTER A是一个大写“A”，COMBINING RING ABOVE是一个  ̊，LATIN CAPITAL LETTER A WITH RING ABOVE，这是Å前两者的组合不等同于后者。</p>

<p>Clients that use persistent connections SHOULD limit the number of simultaneous connections that they maintain to a given server. A single-user client SHOULD NOT maintain more than 2 connections with any server or proxy. A proxy SHOULD use up to 2*N connections to another server or proxy, where N is the number of simultaneously active users. These guidelines are intended to improve HTTP response times and avoid congestion.</p></blockquote>

<p> <blockquote><p>Clients that use persistent connections SHOULD limit the number of simultaneous connections that they maintain to a given server. A single-user client SHOULD NOT maintain more than 2 connections with any server or proxy. A proxy SHOULD use up to 2*N connections to another server or proxy, where N is the number of simultaneously active users. These guidelines are intended to improve HTTP response times and avoid congestion.</p><footer><strong><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1.4">http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1.4</a></strong> <cite>Hypertext Transfer Protocol &ndash; HTTP/1.1 - Sec. 8.1.4</cite></footer></blockquote></p>

<ul>
<li><p><code>NSNumericSearch</code>：它对字符串里的数字排序，所以 “Section 9” &lt; “Section 20” &lt; “Section 100.”</p></li>
<li><p><code>NSDiacriticInsensitiveSearch</code> : “A”等同于“Å”等同于“Ä.”</p></li>
<li><p><code>NSWidthInsensitiveSearch</code> : 一些东亚文字（平假名 和 片假名）有全宽与半宽两种形式。
很值得一提的是 <code>- (NSComparisonResult)localizedStandardCompare:</code>，它排序的方式和 Finder 一样。它对应的选项是 <code>NSCaseInsensitiveSearch</code>、<code>NSNumericSearch</code>、 <code>NSWidthInsensitiveSearch</code> 以及 <code>NSForcedOrderingSearch</code> 。如果我们要在UI上显示一个文件列表，用它就最合适不过了。</p></li>
</ul>


<p>大小写不敏感的比较和音调符号不敏感的比较都是相对复杂和昂贵的操作。如果我们需要比较很多次字符串那这就会成为一个性能上的瓶颈（例如对一个大的数据集进行排序），一个常见的解决方法是同时存储原始字符串和折叠字符串。例如，我们的 <code>Contact</code>  类有一个正常的 <code>name</code>  属性，在内部它还有一个 <code>foldedName</code>  属性，它将自动在 <code>name</code> 变化时更新。那么我们就可以使用 <code>NSLiteralSearch</code>  来比较 <code>name</code> 的折叠版本。<code>NSString</code> 有一个方法来创建折叠版本：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">stringByFoldingWithOptions:</span><span class="p">(</span><span class="n">NSStringCompareOptions</span><span class="p">)</span><span class="nv">options</span>
</span><span class='line'>                                  <span class="nf">locale:</span><span class="p">(</span><span class="bp">NSLocale</span> <span class="o">*</span><span class="p">)</span><span class="nv">locale</span>
</span></code></pre></td></tr></table></div></figure>


<h2>搜索</h2>

<p>要在一个字符串中搜索子字符串，最灵活性的方法是:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="nf">rangeOfString:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">aString</span>
</span><span class='line'>                 <span class="nf">options:</span><span class="p">(</span><span class="n">NSStringCompareOptions</span><span class="p">)</span><span class="nv">mask</span>
</span><span class='line'>                   <span class="nf">range:</span><span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="nv">searchRange</span>
</span><span class='line'>                  <span class="nf">locale:</span><span class="p">(</span><span class="bp">NSLocale</span> <span class="o">*</span><span class="p">)</span><span class="nv">locale</span>
</span></code></pre></td></tr></table></div></figure>


<p>同时，还有一些“便捷方法”，它们在最终都会调用上面这个方法，我们可以传入上面列出的参数，以及以下这些额外的参数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSBackwardsSearch</span>
</span><span class='line'><span class="n">NSAnchoredSearch</span>
</span><span class='line'><span class="n">NSRegularExpressionSearch</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p><code>NSBackwardsSearch</code>：在字符串的末尾开始反向搜索。</p></li>
<li><p><code>NSAnchoredSearch</code>： 只考虑搜索的起始点（单独使用）或终止点（当与  <code>NSBackwardsSearch</code> 结合使用时）。这个方法可以用来检查前缀或者后缀，以及 <em>大小写不敏感（case-insensitive）</em>或者 <em>音调不敏感（diacritic-insensitive）</em>的比较。</p></li>
<li><p><code>NSRegularExpressionSearch</code>：使用正则表达式搜索，要了解更多与使用正则表达式有关的信息，请关注 Chris’s 的 String Parsing 。</p></li>
</ul>


<p>另外，还有一个方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="nf">rangeOfCharacterFromSet:</span><span class="p">(</span><span class="bp">NSCharacterSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">aSet</span>
</span><span class='line'>                           <span class="nf">options:</span><span class="p">(</span><span class="n">NSStringCompareOptions</span><span class="p">)</span><span class="nv">mask</span>
</span><span class='line'>                             <span class="nf">range:</span><span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="nv">aRange</span>
</span></code></pre></td></tr></table></div></figure>


<p>与前面搜索字符串不同的是， 它只搜索给定字符集的第一个字符。即使只搜索一个字符，但如果由于此字符是由元字符组成的序列（composed character sequence），所以返回范围的长度也可能大于1。</p>

<h2>大写与小写</h2>

<p>一定不要使用 <code>NSString</code> 的 <code>-uppercaseString</code>  或者 <code>-lowercaseString</code> 的方法来处理 UI 显示的字符串，而应该使用 <code>-uppercaseStringWithLocale</code> 来代替， 比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="s">@&quot;Tómas&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="nl">uppercaseStringWithLocale</span><span class="p">:[</span><span class="bp">NSLocale</span> <span class="n">currentLocale</span><span class="p">]];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>格式化字符串</h2>

<p>同 <strong>C</strong> 语言中的 <code>sprintf</code> 函数( ANSI C89 中的一个函数 )类似, <strong>Objective-C</strong> 中的 <code>NSString</code> 类也有如下的3个方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span><span class="nf">initWithFormat:</span>
</span><span class='line'><span class="p">-</span><span class="nf">initWithFormat:arguments:</span>
</span><span class='line'><span class="p">+</span><span class="nf">stringWithFormat:</span>
</span></code></pre></td></tr></table></div></figure>


<p>需要注意这些格式化方法都是 <strong><em>非本地化</em></strong> 的 。所以这些方法得到的字符串是不能直接拿来显示在用户界面上的。如果需要本地化，那我们需要使用下面这些方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span><span class="nf">initWithFormat:locale:</span>
</span><span class='line'><span class="p">-</span><span class="nf">initWithFormat:locale:arguments:</span>
</span><span class='line'><span class="p">+</span><span class="nf">localizedStringWithFormat:</span>
</span></code></pre></td></tr></table></div></figure>


<p>Florian 有一篇关于<a href="http://www.objc.io/issue-9/string-localization.html#localized-format-strings">字符串的本地化</a>的文章更详细地讨论了这个问题。</p>

<p><a href="http://linux.die.net/man/3/printf">printf(3)</a>的man页面有关于它如何格式化字符串的全部细节。除了所谓的转换格式（它以％字符开始），格式化字符串会被逐字复制：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">25812.8074434</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">376.730313461</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%g :: %g&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">];</span>
</span><span class='line'><span class="c1">// &quot;25812.8 :: 376.73&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们格式化了两个浮点数。注意单精度浮点数和双精度浮点数能同一个转换格式。</p>

<h2>对象</h2>

<p>除了来自 <a href="http://linux.die.net/man/3/printf">printf(3)</a> 的转换规范，我们还可以使用 <code>%@</code> 来输出一个对象。在对象描述那一节中有述，如果对象响应 <code>-descriptionWithLocale:</code> 方法，则调用它，否则调用 <code>-description</code>。<code>%@</code> 被结果替换。</p>

<h2>整数</h2>

<p>使用整形数字时，有些需要注意的细节。首先，有符号数（d和i）和无符号数（o、u、x和X）分别有转换规范。需要使用者选择具体的类型。
如果我们使用的东西是 <code>printf</code> 不知道的，我们必须要做类型转换。<code>NSUInteger</code> 正是这样一个例子，它在64位和32位平台上是不一样的。下面的例子可以同时工作在32位和64位平台。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">uint64_t</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2305843009213693951</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;The ninth Mersenne prime is %llu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">p</span><span class="p">];</span>
</span><span class='line'><span class="c1">// &quot;The ninth Mersenne prime is 2305843009213693951&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<table>
<thead>
<tr>
<th style="text-align:center;">    Modifier   </th>
<th style="text-align:center;">      d, i      </th>
<th style="text-align:center;">     o, u, x, X        </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">  hh           </td>
<td style="text-align:center;">  signed char   </td>
<td style="text-align:center;">  unsigned char        </td>
</tr>
<tr>
<td style="text-align:center;">  h            </td>
<td style="text-align:center;">  short         </td>
<td style="text-align:center;">  unsigned short       </td>
</tr>
<tr>
<td style="text-align:center;">  (none)       </td>
<td style="text-align:center;">  int           </td>
<td style="text-align:center;">  unsigned int         </td>
</tr>
<tr>
<td style="text-align:center;">  l (ell)      </td>
<td style="text-align:center;">  long          </td>
<td style="text-align:center;">  unsigned long        </td>
</tr>
<tr>
<td style="text-align:center;">  ll (ell ell) </td>
<td style="text-align:center;">  long long     </td>
<td style="text-align:center;">  unsigned long long   </td>
</tr>
<tr>
<td style="text-align:center;">  j            </td>
<td style="text-align:center;">  intmax_t      </td>
<td style="text-align:center;">  uintmax_t            </td>
</tr>
<tr>
<td style="text-align:center;">  t            </td>
<td style="text-align:center;">  ptrdiff_t     </td>
<td style="text-align:center;">                       </td>
</tr>
<tr>
<td style="text-align:center;">  z            </td>
<td style="text-align:center;">                </td>
<td style="text-align:center;">  size_t               </td>
</tr>
</tbody>
</table>


<p>适用于整数的转换规则有：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="mi">150004021</span><span class="p">;</span>
</span><span class='line'><span class="n">uint</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">150004021U</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;d:%d i:%i o:%o u:%u x:%x X:%X&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">];</span>
</span><span class='line'><span class="c1">// &quot;d:-150004021 i:-150004021 o:1074160465 u:150004021 x:8f0e135 X:8F0E135&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>%d</code> 和 <code>%i</code> 具有一样的功能，它们都打印出有符号十进制数。<code>%o</code> 就较为晦涩了：它使用八进制表示。<code>%u</code> 输出无符号十进制数——它是我们常用的。最后 <code>%x</code> 和 <code>%X</code> 使用十六进制表示——后者使用大写字母。</p>

<p>对于 <code>x%</code> 和 <code>X%</code>，我们可以在 0x 前面添加 “#” 井字符前缀看，增加可读性。
我们可以传入特定参数，来设置最小字段宽度和最小数字位数（默认两者都是0），以及左/右对齐。请查看man页面获取详细信息。下面是一些例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;&#39;%4d&#39; &#39;%-4d&#39; &#39;%+4d&#39; &#39;%4.3d&#39; &#39;%04d&#39;&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">];</span>
</span><span class='line'><span class="c1">// ‘42’ ‘42 ’ ‘ +42’ ‘ 042’ ‘0042’</span>
</span><span class='line'><span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="mi">42</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;&#39;%4d&#39; &#39;%-4d&#39; &#39;%+4d&#39; &#39;%4.3d&#39; &#39;%04d&#39;&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">];</span>
</span><span class='line'><span class="c1">// ‘ -42’ ‘-42 ’ ‘ -42’ ‘-042’ ‘-042’</span>
</span></code></pre></td></tr></table></div></figure>


<p>%p  可用于打印出指针——它和 %#x  相似但可同时在32位和64位平台上正常工作。</p>

<h2>浮点数</h2>

<p>关于浮点数的转换规则有8个：eEfFgGaA。但除了 <code>%f</code> 和 <code>%g</code> 外我们很少使用其它的。对于指数部分，小写的版本使用小写 e，大写的版本就使用大写 E。
通常 <code>%g</code>  是浮点数的全能转换符 ，它与 <code>%f</code>  的不同在下面的例子里显示得很清楚：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">double</span> <span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">12345</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.12345678901234</span><span class="p">,</span> <span class="mf">0.0000012345678901234</span><span class="p">};</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%g %g %g %g %g&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]];</span>
</span><span class='line'><span class="c1">// &quot;12345 12 0.12 0.123457 1.23457e-06&quot;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%f %f %f %f %f&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]];</span>
</span><span class='line'><span class="c1">// &quot;12345.000000 12.000000 0.120000 0.123457 0.000001&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>和整数一样，我们依然可以指定最小字段宽度和最小数字数。</p>

<h2>指定位置</h2>

<p>格式化字符串允许使用参数来改变顺序：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%2$@ %1$@&quot;</span><span class="p">,</span> <span class="s">@&quot;1st&quot;</span><span class="p">,</span> <span class="s">@&quot;2nd&quot;</span><span class="p">];</span>
</span><span class='line'><span class="c1">// &quot;2nd 1st&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们只需将从1开始的参数与一个$接在%后面。这种写法在进行本地化的时候极其常见，因为在不同语言中，各个参数所处的顺序位置可能不尽相同。</p>

<h2>NSLog()</h2>

<p><code>NSLog()</code> 函数与 <code>+stringWithFormat:</code> 的工作方式一样。我们可以调用：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">int</span> <span class="n">magic</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;The answer is %d&quot;</span><span class="p">,</span> <span class="n">magic</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>下面的代码可以用同样的方式构造字符串：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">int</span> <span class="n">magic</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;The answer is %d&quot;</span><span class="p">,</span> <span class="n">magic</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>显然 <code>NSLog()</code> 会输出字符串，并且它会加上时间戳、进程名、进程ID以及线程ID作为前缀。</p>

<h2>实现能接受格式化字符串的方法</h2>

<p>有时在我们自己的类中提供一个能接受格式化字符串的方法会很方便使用。假设我们要实现的是一个 To Do 应用，它包含一个 <code>Item</code> 类。我们想要提供：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">itemWithTitleFormat:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">format</span><span class="p">,</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>如此我们就可以使用：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">Item</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="p">[</span><span class="n">Item</span> <span class="nl">itemWithFormat</span><span class="p">:</span><span class="s">@&quot;Need to buy %@ for %@&quot;</span><span class="p">,</span> <span class="n">food</span><span class="p">,</span> <span class="n">pet</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>这种类型的方法可以接受可变数量的参数，所以被称为可变参数方法。我们必须使用一个定义在 <code>stdarg.h</code> 里的宏来使用可变参数。上面方法的实现代码可能会像下面这样：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">itemWithTitleFormat:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">format</span><span class="p">,</span> <span class="p">...;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">va_list</span> <span class="n">ap</span><span class="p">;</span>
</span><span class='line'>    <span class="n">va_start</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">title</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSString</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFormat</span><span class="p">:</span><span class="n">format</span> <span class="nl">locale</span><span class="p">:[</span><span class="bp">NSLocale</span> <span class="n">currentLocale</span><span class="p">]</span> <span class="nl">arguments</span><span class="p">:</span><span class="n">ap</span><span class="p">];</span>
</span><span class='line'>    <span class="n">va_end</span><span class="p">(</span><span class="n">ap</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">itemWithTitle</span><span class="p">:</span><span class="n">title</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>进一步，我们要添加 <code>NS_FORMAT_FUNCTION</code> 到方法的定义里（在头文件中），如下所示：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">itemWithTitleFormat:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">format</span><span class="p">,</span> <span class="p">...</span> <span class="n">NS_FORMAT_FUNCTION</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>NS_FORMAT_FUNCTION</code> 展开为一个方法 <code>__attribute__</code>，它会告诉编译器在索引 1 处的参数是一个格式化字符串，而实际参数从索引2开始。这将允许编译器检查格式化字符串而且会像 <code>NSLog()</code> 和 <code>-[NSString stringWithFormat:]</code> 一样输出警告信息。</p>

<h2>字符与字符串组件</h2>

<p>如有一个字符串“bird”，找出组成它的独立字母是很简单的。第二个字母是“i”（Unicode: LATIN SMALL LETTER I）。而对于像Åse这样的字符串就没那么简单了。看起来像三个字母的组合可有多种方式，例如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">A</span> <span class="n">LATIN</span> <span class="n">CAPITAL</span> <span class="n">LETTER</span> <span class="n">A</span>
</span><span class='line'><span class="err">̊</span> <span class="n">COMBINING</span> <span class="n">RING</span> <span class="n">ABOVE</span>
</span><span class='line'><span class="n">s</span> <span class="n">LATIN</span> <span class="n">SMALL</span> <span class="n">LETTER</span> <span class="n">S</span>
</span><span class='line'><span class="n">e</span> <span class="n">LATIN</span> <span class="n">SMALL</span> <span class="n">LETTER</span> <span class="n">E</span>
</span></code></pre></td></tr></table></div></figure>


<p>或者</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">Å</span> <span class="n">LATIN</span> <span class="n">CAPITAL</span> <span class="n">LETTER</span> <span class="n">A</span> <span class="n">WITH</span> <span class="n">RING</span> <span class="n">ABOVE</span>
</span><span class='line'><span class="n">s</span> <span class="n">LATIN</span> <span class="n">SMALL</span> <span class="n">LETTER</span> <span class="n">S</span>
</span><span class='line'><span class="n">e</span> <span class="n">LATIN</span> <span class="n">SMALL</span> <span class="n">LETTER</span> <span class="n">E</span>
</span></code></pre></td></tr></table></div></figure>


<p>从 <a href="http://www.objc.io/issue-9/unicode.html#peculiar-unicode-features">Ole 写的这篇关于 Unicode 的文章</a> 里可以读到更多关于联合标记（<strong>combining marks</strong>）的信息，其他语言文字有更多复杂的代理对（<strong>complicated surrogate pairs</strong>）。</p>

<p>如果我们要在字符层面处理一个字符串，那我们就要小心翼翼。苹果官方文档中 <strong>String Programming Guide</strong> 有一节叫做 “<strong>Characters and Grapheme Clusters</strong>”，里面有更多关于这一点的细节。</p>

<p><code>NSString</code> 有两个方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span><span class="nf">rangeOfComposedCharacterSequencesForRange:</span>
</span><span class='line'><span class="p">-</span><span class="nf">rangeOfComposedCharacterSequenceAtIndex:</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面这两个方法在有的时候很有帮助，例如，分开一个字符串时保证我们不会分开被称为代理对（<strong>surrogate pairs</strong>）的东西。</p>

<p>如果我们要在字符串的字符上做工作，<code>NSString</code> 有个叫做 <code>-enumerateSubstringsInRange:options:usingBlock:</code> 的方法。
将 <code>NSStringEnumerationByComposedCharacterSequences</code> 作为选项传递，我们就能扫描所有的字符。例如，用下面的方法，我们可将字符串 “International Business Machines” 变成 “IBM”。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">initials</span><span class="p">;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableString</span> <span class="n">string</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span> <span class="nl">enumerateSubstringsInRange</span><span class="p">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
</span><span class='line'>                             <span class="nl">options</span><span class="p">:</span><span class="n">NSStringEnumerationByWords</span> <span class="o">|</span> <span class="n">NSStringEnumerationLocalized</span>
</span><span class='line'>                          <span class="nl">usingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="n">word</span><span class="p">,</span> <span class="n">NSRange</span> <span class="n">wordRange</span><span class="p">,</span> <span class="n">NSRange</span> <span class="n">enclosingWordRange</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">stop1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">__block</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">firstLetter</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span> <span class="nl">enumerateSubstringsInRange</span><span class="p">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">word</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
</span><span class='line'>                                 <span class="nl">options</span><span class="p">:</span><span class="n">NSStringEnumerationByComposedCharacterSequences</span>
</span><span class='line'>                              <span class="nl">usingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="n">letter</span><span class="p">,</span> <span class="n">NSRange</span> <span class="n">letterRange</span><span class="p">,</span> <span class="n">NSRange</span> <span class="n">enclosingLetterRange</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">stop2</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">firstLetter</span> <span class="o">=</span> <span class="n">letter</span><span class="p">;</span>
</span><span class='line'>            <span class="o">*</span><span class="n">stop2</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}];</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">letter</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">[</span><span class="n">result</span> <span class="nl">appendString</span><span class="p">:</span><span class="n">letter</span><span class="p">];</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如文档所示，词和句的分界可能基于地区的变化而变化。因此有 <code>NSStringEnumerationLocalized</code> 选项。</p>

<h2>多行文字字面量</h2>

<p>编译器的确有一个隐蔽的特性：把空格分隔开的字符串衔接到一起。这是什么意思呢？下面两段代码是完全等价的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">limerick</span> <span class="o">=</span> <span class="s">@&quot;A lively young damsel named Menzies</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">@&quot;Inquired: «Do you know what this thenzies?»</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">@&quot;Her aunt, with a gasp,</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">@&quot;Replied: &quot;</span><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">a</span> <span class="n">wasp</span><span class="p">,</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">@&quot;And you&#39;re holding the end where the stenzies.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>和</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">limerick</span> <span class="o">=</span> <span class="s">@&quot;A lively young damsel named Menzies</span><span class="se">\n</span><span class="s">Inquired: «Do you know what this thenzies?»</span><span class="se">\n</span><span class="s">Her aunt, with a gasp,</span><span class="se">\n</span><span class="s">Replied: &quot;</span><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">a</span> <span class="n">wasp</span><span class="p">,</span><span class="err">\</span><span class="n">nAnd</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">holding</span> <span class="n">the</span> <span class="n">end</span> <span class="n">where</span> <span class="n">the</span> <span class="n">stenzies</span><span class="p">.</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;;</span>
</span></code></pre></td></tr></table></div></figure>


<p>前者看起来更舒服，但是有一点要注意千万不要在任意一行末尾加入逗号或者分号。
同时也可以这样做：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSString</span> <span class="o">*</span> <span class="n">string</span> <span class="o">=</span> <span class="s">@&quot;The man &quot;</span> <span class="s">@&quot;who knows everything &quot;</span> <span class="s">@&quot;learns nothing&quot;</span> <span class="s">@&quot;.&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>*译者注：上面这行代码原文是有误的，原文是</p>

<pre><code class="objc">NSString *@"The man " @"who knows everything " @"learns nothing" @".";
</code></pre>

<p>读者可以尝试一下，如果这样写是无法通过编译的;</p></blockquote>

<p>编译器只是为我们提供了一个便捷的方式，将多个字符串在编译期组合在了一起。</p>

<h2>可变字符串</h2>

<p>可变字符串有两个常见的使用场景：</p>

<blockquote><ol>
<li>拼接字符串</li>
<li>替换部分字符串</li>
</ol>
</blockquote>

<h3>创建字符串</h3>

<p>可变字符串可以很轻易地把多个字符串在你需要的时候组合起来。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">magicToken</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableString</span> <span class="n">string</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">usePrefix</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">string</span> <span class="nl">appendString</span><span class="p">:</span><span class="s">@&quot;&gt;&gt;&gt;&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">[</span><span class="n">string</span> <span class="nl">appendFormat</span><span class="p">:</span><span class="s">@&quot;%d--%d&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">foo</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">bar</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">useSuffix</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">string</span> <span class="nl">appendString</span><span class="p">:</span><span class="s">@&quot;&gt;&gt;&gt;&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">string</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里要注意的是，虽然原本返回值应该是一个 <code>NSString</code> 类型的对象，我们只是简单地返回一个 <code>NSMutableString</code> 类型的对象。</p>

<h3>替换字符串</h3>

<p>可变字符串除了追加组合之外，还提供了以下4个方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span><span class="nf">deleteCharactersInRange:</span>
</span><span class='line'><span class="p">-</span><span class="nf">insertString:atIndex:</span>
</span><span class='line'><span class="p">-</span><span class="nf">replaceCharactersInRange:withString:</span>
</span><span class='line'><span class="p">-</span><span class="nf">replaceOccurrencesOfString:withString:options:range:</span>
</span></code></pre></td></tr></table></div></figure>


<p>这些方法和 <code>NSString</code> 的类似：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span><span class="nf">stringByReplacingOccurrencesOfString:withString:</span>
</span><span class='line'><span class="p">-</span><span class="nf">stringByReplacingOccurrencesOfString:withString:options:range:</span>
</span><span class='line'><span class="p">-</span><span class="nf">stringByReplacingCharactersInRange:withString:</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是它没有创建新的字符串仅仅把当前字符串变成了一个可变的类型，这样让代码更容易阅读，以及提升些许性能。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">string</span><span class="p">;</span> <span class="c1">// 假设我们已经有了一个名为 string 的字符串</span>
</span><span class='line'><span class="c1">// 现在要去掉它的一个前缀，做法如下:</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">@&quot;WeDon’tWantThisPrefix&quot;</span>
</span><span class='line'><span class="n">NSRange</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">string</span> <span class="nl">rangeOfString</span><span class="p">:</span><span class="n">prefix</span>
</span><span class='line'>                          <span class="nl">options</span><span class="p">:</span><span class="n">NSAnchoredSearch</span>
</span><span class='line'>                            <span class="nl">range</span><span class="p">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">string</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
</span><span class='line'>                           <span class="nl">locale</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">location</span> <span class="o">!=</span> <span class="n">NSNotFound</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">string</span> <span class="nl">deleteCharactersInRange</span><span class="p">:</span><span class="n">r</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>连接组件</h2>

<p>一个看似微不足道但很常见的情况是字符串连接。比如现在有这样几个字符串：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">Hildr</span>
</span><span class='line'><span class="n">Heidrun</span>
</span><span class='line'><span class="n">Gerd</span>
</span><span class='line'><span class="n">Gu</span><span class="err">ð</span><span class="n">r</span><span class="err">ú</span><span class="n">n</span>
</span><span class='line'><span class="n">Freya</span>
</span><span class='line'><span class="n">Nanna</span>
</span><span class='line'><span class="n">Siv</span>
</span><span class='line'><span class="n">Ska</span><span class="err">ð</span><span class="n">i</span>
</span><span class='line'><span class="n">Gr</span><span class="err">ó</span><span class="n">a</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们想用它们来创建下面这样的一个字符串：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">Hildr</span><span class="p">,</span> <span class="n">Heidrun</span><span class="p">,</span> <span class="n">Gerd</span><span class="p">,</span> <span class="n">Gu</span><span class="err">ð</span><span class="n">r</span><span class="err">ú</span><span class="n">n</span><span class="p">,</span> <span class="n">Freya</span><span class="p">,</span> <span class="n">Nanna</span><span class="p">,</span> <span class="n">Siv</span><span class="p">,</span> <span class="n">Ska</span><span class="err">ð</span><span class="n">i</span><span class="p">,</span> <span class="n">Gr</span><span class="err">ó</span><span class="n">a</span>
</span></code></pre></td></tr></table></div></figure>


<p>那么就可以这样做：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">names</span> <span class="o">=</span> <span class="l">@[</span><span class="s">&quot;Hildr&quot;</span><span class="p">,</span> <span class="s">@&quot;Heidrun&quot;</span><span class="p">,</span> <span class="s">@&quot;Gerd&quot;</span><span class="p">,</span> <span class="s">@&quot;Guðrún&quot;</span><span class="p">,</span> <span class="s">@&quot;Freya&quot;</span><span class="p">,</span> <span class="s">@&quot;Nanna&quot;</span><span class="p">,</span> <span class="s">@&quot;Siv&quot;</span><span class="p">,</span> <span class="s">@&quot;Skaði&quot;</span><span class="p">,</span> <span class="s">@&quot;Gróa&quot;</span><span class="l">]</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span> <span class="nl">componentsJoinedByString</span><span class="p">:</span><span class="s">@&quot;, &quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果我们将其显示给用户，我们就要使用本地化表达，确保将最后一部分替换相应语言的 “, and” ：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@implementation</span> <span class="bp">NSArray</span> <span class="nl">(ObjcIO_GroupedComponents)</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">groupedComponentsWithLocale:</span><span class="p">(</span><span class="bp">NSLocale</span> <span class="o">*</span><span class="p">)</span><span class="nv">locale</span><span class="p">;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">@&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">self</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="bp">NSString</span> <span class="o">*</span><span class="n">joiner</span> <span class="o">=</span> <span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;joiner.2components&quot;</span><span class="p">,</span> <span class="s">@&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%@%@%@&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">joiner</span><span class="p">,</span> <span class="nb">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="bp">NSString</span> <span class="o">*</span><span class="n">joiner</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%@ &quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">locale</span> <span class="nl">objectForKey</span><span class="p">:</span><span class="n">NSLocaleGroupingSeparator</span><span class="p">]];</span>
</span><span class='line'>        <span class="bp">NSArray</span> <span class="o">*</span><span class="n">first</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">subarrayWithRange</span><span class="p">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)];</span>
</span><span class='line'>        <span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableString</span> <span class="nl">stringWithString</span><span class="p">:[</span><span class="n">first</span> <span class="nl">componentsJoinedByString</span><span class="p">:</span><span class="n">joiner</span><span class="p">]];</span>
</span><span class='line'>        <span class="bp">NSString</span> <span class="o">*</span><span class="n">lastJoiner</span> <span class="o">=</span> <span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;joiner.3components&quot;</span><span class="p">,</span> <span class="s">@&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">[</span><span class="n">result</span> <span class="nl">appendString</span><span class="p">:</span><span class="n">lastJoiner</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">result</span> <span class="nl">appendString</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">lastObject</span><span class="p">];</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>那么在本地化的时候，如果是英语，应该是：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="s">&quot;joiner.2components&quot;</span> <span class="o">=</span> <span class="s">&quot; and &quot;</span><span class="p">;</span>
</span><span class='line'><span class="s">&quot;joiner.3components&quot;</span> <span class="o">=</span> <span class="s">&quot;, and &quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果是德语，则应该是：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="s">&quot;joiner.2components&quot;</span> <span class="o">=</span> <span class="s">&quot; und &quot;</span><span class="p">;</span>
</span><span class='line'><span class="s">&quot;joiner.3components&quot;</span> <span class="o">=</span> <span class="s">&quot; und &quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>结合组件的逆过程可以用 <code>-componentsSeparatedByString:</code>，这个方法会将一个字符串变成一个数组。例如，将 “12|5|3” 变成 “12”、“5” 和 “3”。</p>

<h2>对象描述</h2>

<p>在许多面向对象编程语言里，对象有一个叫做 <code>toString()</code> 或类似的方法。在 <strong>Objective-C</strong> 里，这个方法是：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">description</span>
</span></code></pre></td></tr></table></div></figure>


<p>以及它的兄弟方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">debugDescription</span>
</span></code></pre></td></tr></table></div></figure>


<p>当自定义模型对象时，覆写 <code>-description</code> 方法是一个好习惯，在UI上显示该对象时调用的就是 <code>-description</code> 方法的返回值。假定我们有一个 <code>Contact</code> 类，下面是它的 <code>-description</code> 方法实现。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">description</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们可以像下面代码这样格式化字符串：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;%@ has been added to the group “%@”.&quot;</span><span class="p">,</span> <span class="s">@&quot;&quot;</span><span class="p">),</span> <span class="n">contact</span><span class="p">,</span> <span class="n">group</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>因为该字符串是用来做UI显示的，我们可能需要做本地化，那么我们就需要覆写</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">descriptionWithLocale:</span><span class="p">(</span><span class="bp">NSLocale</span> <span class="o">*</span><span class="p">)</span><span class="nv">locale</span>
</span></code></pre></td></tr></table></div></figure>


<p>方法。</p>

<p><code>%@</code> 会首先调用 <code>-descriptionWithLocale</code>，如果没有返回值，再调用 <code>-description</code>，在调试时，打印一个对象，我们用 <code>po</code> 这个命令（它是 print object 的缩写）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">(</span><span class="n">lldb</span><span class="p">)</span> <span class="n">po</span> <span class="n">contact</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果在调试窗口的终端下输入 <code>po contact</code>，它会调用对象的 <code>-debugDescription</code> 方法。默认情况下 <code>-debugDescription</code> 是直接调用 <code>-description</code>。如果你希望输出不同的信息，那么就分别覆写两个方法。大多数情况下，尤其是对于非数据模型的对象，你只需要覆写 <code>-description</code> 就能满足需求了。</p>

<p>实际上对象的标准格式化输出是这样的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">description</span><span class="p">;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;&lt;%@: %p&gt;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="k">class</span><span class="p">,</span> <span class="nb">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>NSObject</code> 就是这么干的。当你覆写该方法时，也可以像这样写。假定我们有一个 <code>DetailViewController</code>，在它的UI上要显示一个 <code>contact</code> ，我们可能会这样覆写该方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">description</span><span class="p">;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;&lt;%@: %p&gt; contact = %@&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="k">class</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">contact</span><span class="p">.</span><span class="n">debugDescription</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>NSManagedObject 子类的描述</h2>

<p>我们将特别注意向 <code>NSManagedObject</code> 的子类添加 <code>-description</code> / <code>-debugDescription</code> 的情况。由于 <strong>Core Data</strong> 的惰性加载机制（<strong>faulting mechanism</strong>）允许未加载数据的对象存在，所以当我们调用 <code>-debugDescription</code> 我们并不希望改变我们的应用程序的状态，因此我要确保检查 isFault  这个属性。例如，我们可如下这样实现它：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">debugDescription</span><span class="p">;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">description</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;&lt;%@: %p&gt;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="k">class</span><span class="p">,</span> <span class="nb">self</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">self</span><span class="p">.</span><span class="n">isFault</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">description</span> <span class="nl">appendFormat</span><span class="p">:</span><span class="s">@&quot; %@ </span><span class="se">\&quot;</span><span class="s">%@</span><span class="se">\&quot;</span><span class="s"> %gL&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">metricVolume</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">description</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>再次，因为它们是模型对象，重载 <code>-description</code> 简单地返回描述实例的属性名就可以了。</p>

<h2>文件路径</h2>

<p>简单来说就是我们不应该使用 <code>NSString</code> 来描述文件路径。对于 OS X 10.7 和 iOS 5， <code>NSURL</code> 更便于使用，而且更有效率，它还能缓存文件系统的属性。
再者，<code>NSURL</code> 有八个方法来访问被称为 <strong>resource values</strong> 的东西。它们提供给我们一个稳定的接口来获取和设置文件与目录的多种属性，例如本地化文件名（<code>NSURLLocalizedNameKey</code>）、文件大小（<code>NSURLFileSizeKey</code>），以及创建日期（ <code>NSURLCreationDateKey</code>），等等。
尤其是在遍历目录内容时，使用 <code>-[NSFileManager enumeratorAtURL:includingPropertiesForKeys:options:errorHandler:]</code> 附带一个关键词列表，然后用 <code>-getResourceValue:forKey:error:</code> 检索它们，能带来显著的性能提升。</p>

<p>下面是一个简短的例子展示了如何将它们组合在一起：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSFileManager</span> <span class="o">*</span><span class="n">fm</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">fm</span> <span class="nl">URLForDirectory</span><span class="p">:</span><span class="n">NSDocumentationDirectory</span>
</span><span class='line'>                              <span class="nl">inDomain</span><span class="p">:</span><span class="n">NSUserDomainMask</span>
</span><span class='line'>                     <span class="nl">appropriateForURL</span><span class="p">:</span><span class="nb">nil</span>
</span><span class='line'>                                <span class="nl">create</span><span class="p">:</span><span class="nb">NO</span>
</span><span class='line'>                                 <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">properties</span> <span class="o">=</span> <span class="l">@[</span><span class="n">NSURLLocalizedNameKey</span><span class="p">,</span> <span class="n">NSURLCreationDateKey</span><span class="l">]</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSDirectoryEnumerator</span> <span class="o">*</span><span class="n">dirEnumerator</span> <span class="o">=</span> <span class="p">[</span><span class="n">fm</span> <span class="nl">enumeratorAtURL</span><span class="p">:</span><span class="n">documents</span>
</span><span class='line'>                                <span class="nl">includingPropertiesForKeys</span><span class="p">:</span><span class="n">properties</span>
</span><span class='line'>                                                   <span class="nl">options</span><span class="p">:</span><span class="mi">0</span>
</span><span class='line'>                                              <span class="nl">errorHandler</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="n">fileURL</span> <span class="k">in</span> <span class="n">dirEnumerator</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">NSDate</span> <span class="o">*</span><span class="n">creationDate</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">fileURL</span> <span class="nl">getResourceValue</span><span class="p">:</span><span class="o">&amp;</span><span class="n">name</span>
</span><span class='line'>                           <span class="nl">forKey</span><span class="p">:</span><span class="n">NSURLLocalizedNameKey</span>
</span><span class='line'>                            <span class="nl">error</span><span class="p">:</span><span class="nb">NULL</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>        <span class="p">[</span><span class="n">fileURL</span> <span class="nl">getResourceValue</span><span class="p">:</span><span class="o">&amp;</span><span class="n">creationDate</span>
</span><span class='line'>                           <span class="nl">forKey</span><span class="p">:</span><span class="n">NSURLCreationDateKey</span>
</span><span class='line'>                            <span class="nl">error</span><span class="p">:</span><span class="nb">NULL</span><span class="p">])</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;&#39;%@&#39; was created at %@&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">creationDate</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们把属性的键传给  <code>-enumeratorAtURL:</code> 方法中，在遍历目录内容时，这个方法能确保用非常高效的方式获取它们。在循环中，调用 <code>-getResourceValue:</code>… 能简单地从 <code>NSURL</code> 得到已缓存的值，而不用去访问文件系统。</p>

<h2>传递路径到UNIX API</h2>

<p>因为 Unicode 非常复杂，同一个字母有多种表示方式，所以我们需要很小心地传递路径给 UNIX API。在这些情况里，一定不能使用 <code>UTF8String</code>，正确地做法是使用 <code>-fileSystemRepresentation</code> 方法，如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">documentURL</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">]</span> <span class="nl">URLForDirectory</span><span class="p">:</span><span class="n">NSDocumentDirectory</span>
</span><span class='line'>                                                            <span class="nl">inDomain</span><span class="p">:</span><span class="n">NSUserDomainMask</span>
</span><span class='line'>                                                   <span class="nl">appropriateForURL</span><span class="p">:</span><span class="nb">nil</span>
</span><span class='line'>                                                              <span class="nl">create</span><span class="p">:</span><span class="nb">NO</span>
</span><span class='line'>                                                               <span class="nl">error</span><span class="p">:</span><span class="nb">NULL</span><span class="p">];</span>
</span><span class='line'><span class="n">documentURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">documentURL</span> <span class="nl">URLByAppendingPathComponent</span><span class="p">:</span><span class="n">name</span><span class="p">];</span>
</span><span class='line'><span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">documentURL</span><span class="p">.</span><span class="n">fileSystemRepresentation</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>与 <code>NSURL</code> 类似，同样的情况也发生在 <code>NSString</code> 上。如果我们不这么做，在打开一个文件名或路径名包含合成字符的文件时我们将看到随机错误。在 OS X 上，当用户的短名刚好包含合成字符时就会显得特别糟糕。
我们需要一个 <code>char const *</code> 版本的路径的一些常见情况是 UNIX <code>open()</code> 和 <code>close()</code> 指令。但这也可能发生在 GCD / libdispatch 的 I/O API 上。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">dispatch_io_t</span>
</span><span class='line'><span class="nf">dispatch_io_create_with_path</span><span class="p">(</span><span class="kt">dispatch_io_type_t</span> <span class="n">type</span><span class="p">,</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">,</span> <span class="kt">mode_t</span> <span class="n">mode</span><span class="p">,</span>
</span><span class='line'>        <span class="kt">dispatch_queue_t</span> <span class="n">queue</span><span class="p">,</span>
</span><span class='line'>        <span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="n">cleanup_handler</span><span class="p">)(</span><span class="kt">int</span> <span class="n">error</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果我们要使用 <code>NSString</code> 来做，那我们要保证像下面这样做：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// 假设我们已经有一个名为 path 的字符串</span>
</span><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="n">dispatch_io_create_with_path</span><span class="p">(</span><span class="n">DISPATCH_IO_STREAM</span><span class="p">,</span>
</span><span class='line'>    <span class="n">path</span><span class="p">.</span><span class="n">fileSystemRepresentation</span><span class="p">,</span>
</span><span class='line'>    <span class="n">O_RDONLY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">cleanupHandler</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>-fileSystemRepresentation</code> 所做的是它首先将这个字符串转换成文件系统的规范形式然后用 UTF-8 编码。</p>

<p>原文链接：<a href="http://www.objc.io/issue-9/working-with-strings.html">Working with Strings</a>
翻译：<a href="http://iosinit.com/?author=5"> 朱宏旭</a>，<a href="http://weibo.com/riven0951">riven</a>，<a href="http://weibo.com/u/1709283185?sudaref=iosinit.com">@唯木念</a>
译文链接：<a href="http://iosinit.com/?p=854">objc.io 第9期之玩转字符串</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Orin Chen</span></span>

      




<time class='entry-date' datetime='2014-03-07T23:32:36+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:32 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  

  
  <!-- JiaThis Button BEGIN -->
  <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_googleplus">Google+</a>
    <a class="jiathis_button_renren">人人网</a>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
  </div>
  <script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1334720487296344" charset="utf-8"></script>
  <p/>
  <!-- JiaThis Button END -->

</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/03/04/getting-to-know-textkit/" title="Previous Post: 认识 TextKit">&laquo; 认识 TextKit</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/03/15/use-gcd/" title="Next Post: 使用 GCD">使用 GCD &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>文章分类</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/hack/'>hack (4)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (12)</a></li>
<li class='category'><a href='/blog/categories/objective-c/'>objective-c (5)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (1)</a></li>
<li class='category'><a href='/blog/categories/textkit/'>textkit (1)</a></li>
<li class='category'><a href='/blog/categories/zsh/'>zsh (1)</a></li>
<li class='category'><a href='/blog/categories/di-tu/'>地图 (1)</a></li>
<li class='category'><a href='/blog/categories/suan-fa/'>算法 (1)</a></li>

  </ul>
</section><section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/06/create-aliase-of-sublime-text-in-zsh/">在 ZSH 中调用 Sublime Text</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/11/ios7-interactive-transitions/">iOS 7 交互式过渡</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/26/a-look-inside-blocks/">谈 Objective-C Block 的实现</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/20/objective-c-object-model/">Objective-C对象模型及应用</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/15/use-gcd/">使用 GCD</a>
      </li>
    
  </ul>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Orin Chen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'orin-world';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://orinchen.github.io/blog/2014/03/07/working-with-strings/';
        var disqus_url = 'http://orinchen.github.io/blog/2014/03/07/working-with-strings/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
